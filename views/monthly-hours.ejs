<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monthly Hours - Payroll System</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" type="image/png" href="/images/salary.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <style>
    .monthly-hours-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .monthly-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .monthly-header h1 {
      margin: 0;
      font-size: 2em;
      color: #333;
    }

    .month-selector {
      display: flex;
      gap: 10px;
      align-items: center;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .month-selector input {
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }

    .month-selector button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s;
    }

    .month-selector button:hover {
      transform: translateY(-2px);
    }

    .content-section {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 30px;
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 1.3em;
      font-weight: 600;
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #eee;
    }

    .hours-table {
      width: 100%;
      border-collapse: collapse;
    }

    .hours-table th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
    }

    .hours-table td {
      padding: 15px;
      border-bottom: 1px solid #eee;
    }

    .hours-table tr:hover {
      background-color: #f9f9f9;
    }

    .hours-input {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .hours-input input {
      width: 100px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      text-align: center;
    }

    .hours-unit {
      color: #666;
      font-size: 12px;
      font-weight: 600;
    }

    .guard-entry-form {
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
      align-items: flex-end;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .btn-add-hours {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      align-self: flex-end;
    }

    .btn-add-hours:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .hours-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: white;
      border: 1px solid #eee;
      border-radius: 5px;
      margin-bottom: 10px;
    }

    .hours-info {
      flex: 1;
    }

    .hours-info-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .hours-info-details {
      font-size: 13px;
      color: #666;
    }

    .hours-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-card.warning {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .stat-card.success {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .stat-label {
      font-size: 12px;
      opacity: 0.9;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
    }

    .stat-unit {
      font-size: 12px;
      opacity: 0.8;
      margin-top: 5px;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn-icon {
      background: none;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .btn-edit {
      background-color: #e3f2fd;
      color: #1976d2;
    }

    .btn-edit:hover {
      background-color: #1976d2;
      color: white;
    }

    .btn-delete {
      background-color: #ffebee;
      color: #c62828;
    }

    .btn-delete:hover {
      background-color: #c62828;
      color: white;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #999;
    }

    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .graphs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .graph-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #eee;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      position: relative;
      min-height: 350px;
      display: flex;
      flex-direction: column;
    }

    .graph-container canvas {
      flex: 1;
      max-height: 300px;
    }

    .summary-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .summary-card {
      background: white;
      border: 2px solid #eee;
      padding: 20px;
      border-radius: 8px;
    }

    .summary-card-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 15px;
      font-size: 1.1em;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }

    .summary-row:last-child {
      border-bottom: none;
    }

    .summary-label {
      color: #666;
      font-size: 14px;
    }

    .summary-value {
      font-weight: 600;
      color: #333;
    }

    @media (max-width: 768px) {
      .graphs-grid {
        grid-template-columns: 1fr;
      }

      .filters-grid {
        grid-template-columns: 1fr;
      }
    }
      color: #333;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 15px 20px;
      background-color: #4caf50;
      color: white;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      animation: slideInUp 0.3s;
      z-index: 2000;
    }

    .toast.error {
      background-color: #f44336;
    }

    @keyframes slideInUp {
      from {
        transform: translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Global Header -->
  <header>
    <div class="container">
      <div class="header-brand">
        <img src="/images/salary.png" alt="Payroll Logo" class="logo">
        <h1>üíº Payroll Pro</h1>
      </div>
      <nav>
        <ul>
          <li><a href="/">üè† Home</a></li>
          <li><a href="/guards">üë• Guards</a></li>
          <li><a href="/clients">üè¢ Clients</a></li>
          <li><a href="/monthly-hours">‚è∞ Monthly Hours</a></li>
          <li><a href="/reports">üìä Reports</a></li>
          <li><a href="/roster">Roster</a></li>
          <li><a href="/upload">üì§ Upload</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="monthly-hours-container">
    <!-- Header -->
    <div class="monthly-header">
      <h1>üìä Monthly Hours Analysis & Audit</h1>
    </div>

    <!-- Advanced Filters Section -->
    <div class="content-section">
      <div class="section-title">Analysis Filters</div>
      
      <div class="filters-grid">
        <div class="form-group">
          <label>Guard</label>
          <select id="guardFilter" style="padding: 10px 15px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; width: 100%;">
            <option value="">All Guards</option>
          </select>
        </div>

        <div class="form-group">
          <label>Client</label>
          <select id="clientFilter" style="padding: 10px 15px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; width: 100%;">
            <option value="">All Clients</option>
          </select>
        </div>

        <div class="form-group">
          <label>Status</label>
          <select id="statusFilter" style="padding: 10px 15px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; width: 100%;">
            <option value="">All Status</option>
            <option value="pending">Pending</option>
            <option value="paid">Paid</option>
            <option value="partial">Partially Paid</option>
          </select>
        </div>

        <div class="form-group">
          <label>&nbsp;</label>
          <button type="button" class="btn-add-hours" onclick="applyFilters()" style="width: 100%;">Apply Filters</button>
        </div>

        <div class="form-group">
          <label>&nbsp;</label>
          <button type="button" class="btn-add-hours" onclick="clearFilters()" style="width: 100%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">Clear Filters</button>
        </div>
      </div>
    </div>

    <!-- Monthly Hours List -->
    <div class="content-section">
      <div class="section-title">Audit Trail - Hours Entries</div>
      <div id="hoursListContainer">
        <div class="empty-state">
          <p>No data to display. Apply filters to view hours entries.</p>
        </div>
      </div>
    </div>

    <!-- Analysis Graphs Section -->
    <div class="content-section">
      <div class="section-title">Hours Distribution Analysis</div>
      
      <div class="graphs-grid">
        <div class="graph-container">
          <h3 style="text-align: center; color: #333; margin-top: 0;">Hours by Guard</h3>
          <canvas id="hoursBarChart"></canvas>
        </div>

        <div class="graph-container">
          <h3 style="text-align: center; color: #333; margin-top: 0;">Hours Status Breakdown</h3>
          <canvas id="statusPieChart"></canvas>
        </div>
      </div>
    </div>

    <div class="content-section">
      <div class="section-title">Pay Analysis</div>
      
      <div class="graphs-grid">
        <div class="graph-container">
          <h3 style="text-align: center; color: #333; margin-top: 0;">Hours Trend Over Time</h3>
          <canvas id="hoursTrendChart"></canvas>
        </div>

        <div class="graph-container">
          <h3 style="text-align: center; color: #333; margin-top: 0;">Pay Distribution by Guard</h3>
          <canvas id="payDistributionChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Summary Statistics -->
    <div class="content-section">
      <div class="section-title">Summary Statistics</div>
      <div class="summary-section" id="summarySection">
        <div class="summary-card">
          <div class="summary-card-title">Total Hours</div>
          <div class="summary-row">
            <span class="summary-label">Entered:</span>
            <span class="summary-value" id="totalEnteredHours">0</span> h
          </div>
          <div class="summary-row">
            <span class="summary-label">Paid:</span>
            <span class="summary-value" id="totalPaidHours">0</span> h
          </div>
          <div class="summary-row">
            <span class="summary-label">Remaining:</span>
            <span class="summary-value" id="totalRemainingHours">0</span> h
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-card-title">Guard Count</div>
          <div class="summary-row">
            <span class="summary-label">Total Guards:</span>
            <span class="summary-value" id="totalGuards">0</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">With Hours:</span>
            <span class="summary-value" id="guardsWithHours">0</span>
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-card-title">Average Hours</div>
          <div class="summary-row">
            <span class="summary-label">Per Guard:</span>
            <span class="summary-value" id="avgHoursPerGuard">0</span> h
          </div>
          <div class="summary-row">
            <span class="summary-label">Paid Ratio:</span>
            <span class="summary-value" id="paidRatio">0</span>%
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let guardsData = [];
    let clientsData = [];
    let chartsInstances = {};
    let currentFilters = {
      guardId: null,
      clientId: null,
      status: null
    };

    document.addEventListener('DOMContentLoaded', () => {
      initializePage();
    });

    async function initializePage() {
      try {
        // Load guards and clients
        await loadGuards();
        await loadClients();
        
        // Apply initial filters
        applyFilters();
      } catch (error) {
        console.error('Error initializing page:', error);
        showToast('Error initializing page', 'error');
      }
    }

    async function loadGuards() {
      try {
        const response = await fetch('/api/guards?isActive=true');
        const result = await response.json();

        if (result.success) {
          guardsData = result.data;
          const select = document.getElementById('guardFilter');
          select.innerHTML = '<option value="">All Guards</option>' +
            guardsData.map(g => `<option value="${g._id}">${g.guardName}</option>`).join('');
        }
      } catch (error) {
        console.error('Error loading guards:', error);
      }
    }

    async function loadClients() {
      try {
        const response = await fetch('/api/clients');
        const result = await response.json();

        if (result.success) {
          clientsData = result.data || [];
          const select = document.getElementById('clientFilter');
          select.innerHTML = '<option value="">All Clients</option>' +
            clientsData.map(c => `<option value="${c._id}">${c.clientName}</option>`).join('');
        }
      } catch (error) {
        console.error('Error loading clients:', error);
      }
    }

    async function applyFilters() {
      try {
        currentFilters = {
          guardId: document.getElementById('guardFilter').value,
          clientId: document.getElementById('clientFilter').value,
          status: document.getElementById('statusFilter').value
        };

        console.log('üîç Applying filters:', currentFilters);

        // Fetch analysis data
        const queryParams = new URLSearchParams();
        if (currentFilters.guardId) queryParams.append('guardId', currentFilters.guardId);
        if (currentFilters.clientId) queryParams.append('clientId', currentFilters.clientId);
        if (currentFilters.status) queryParams.append('status', currentFilters.status);

        const url = `/api/monthly-hours/analysis?${queryParams.toString()}`;
        console.log('üì° Fetching from:', url);

        const response = await fetch(url);
        const result = await response.json();

        console.log('üì• API Response:', result);

        if (result.success) {
          console.log('‚úÖ Data received successfully:', result.data);
          displayAuditTrail(result.data.entries);
          updateSummaryStatistics(result.data);
          generateGraphs(result.data);
        } else {
          console.error('‚ùå API error:', result.message);
          showToast('Error loading analysis data: ' + result.message, 'error');
        }
      } catch (error) {
        console.error('‚ùå Error applying filters:', error);
        showToast('Error applying filters: ' + error.message, 'error');
      }
    }

    async function clearFilters() {
      document.getElementById('guardFilter').value = '';
      document.getElementById('clientFilter').value = '';
      document.getElementById('statusFilter').value = '';

      applyFilters();
    }

    function displayAuditTrail(entries) {
      const container = document.getElementById('hoursListContainer');

      if (!entries || entries.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>No hours entries found for the selected filters.</p></div>';
        return;
      }

      container.innerHTML = entries.map(entry => {
        // Guard name comes directly from populated data
        const guardName = entry.guardId?.guardName || 'Unknown Guard';
        const createdDate = new Date(entry.createdAt).toLocaleDateString();
        const status = entry.status || 'pending';
        const statusColor = status === 'paid' ? '#4caf50' : status === 'partial' ? '#ff9800' : '#f44336';
        
        return `
          <div class="hours-row" style="border-left: 4px solid ${statusColor};">
            <div class="hours-info">
              <div class="hours-info-title">${guardName}</div>
              <div class="hours-info-details">
                <strong>Entered:</strong> ${entry.totalHours}h ${entry.totalMinutes}m | 
                <strong>Paid:</strong> ${entry.paidHours}h ${entry.paidMinutes}m | 
                <strong>Remaining:</strong> ${entry.remainingHours}h ${entry.remainingMinutes}m
              </div>
              <div class="hours-info-details" style="margin-top: 5px; color: #999; font-size: 12px;">
                üìÖ ${createdDate} | Status: <span style="color: ${statusColor}; font-weight: 600;">${status.toUpperCase()}</span>
              </div>
              ${entry.notes ? `<div class="hours-info-details" style="margin-top: 5px; color: #999; font-style: italic;">üìù ${entry.notes}</div>` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    function updateSummaryStatistics(data) {
      const { summary, entries } = data;
      
      console.log('üìä Summary Data:', summary);
      console.log('üìã Entries Count:', entries?.length || 0);
      
      if (!summary) {
        console.warn('‚ö†Ô∏è No summary data received from API');
        document.getElementById('totalEnteredHours').textContent = '0';
        document.getElementById('totalPaidHours').textContent = '0';
        document.getElementById('totalRemainingHours').textContent = '0';
        document.getElementById('totalGuards').textContent = '0';
        document.getElementById('guardsWithHours').textContent = '0';
        document.getElementById('avgHoursPerGuard').textContent = '0';
        document.getElementById('paidRatio').textContent = '0';
        return;
      }

      const totalEntered = summary.totalHours || 0;
      const totalPaid = summary.paidHours || 0;
      const totalRemaining = summary.remainingHours || 0;
      const totalGuardsFromSummary = summary.totalGuards || entries?.length || 0;
      const avgHours = summary.averageHoursPerGuard || (totalGuardsFromSummary > 0 ? (totalEntered / totalGuardsFromSummary).toFixed(1) : 0);
      const paidRatio = totalEntered > 0 ? ((totalPaid / totalEntered) * 100).toFixed(1) : 0;

      console.log('‚úÖ Updating display with:', { totalEntered, totalPaid, totalRemaining, totalGuardsFromSummary, avgHours, paidRatio });

      document.getElementById('totalEnteredHours').textContent = totalEntered;
      document.getElementById('totalPaidHours').textContent = totalPaid;
      document.getElementById('totalRemainingHours').textContent = totalRemaining;
      document.getElementById('totalGuards').textContent = totalGuardsFromSummary;
      document.getElementById('guardsWithHours').textContent = entries?.length || 0;
      document.getElementById('avgHoursPerGuard').textContent = avgHours;
      document.getElementById('paidRatio').textContent = paidRatio;
    }

    function generateGraphs(data) {
      const { entries, summary } = data;

      if (!entries || entries.length === 0) {
        // Clear all charts if no data
        Object.keys(chartsInstances).forEach(key => {
          if (chartsInstances[key]) chartsInstances[key].destroy();
        });
        chartsInstances = {};
        return;
      }

      // Process data for graphs
      const hoursbyGuard = processHoursByGuard(entries);
      const statusBreakdown = processStatusBreakdown(entries);
      const trendData = processTrendData(entries);
      const payDistribution = processPayDistribution(entries);

      // Generate charts
      generateHoursBarChart(hoursbyGuard);
      generateStatusPieChart(statusBreakdown);
      generateHoursTrendChart(trendData);
      generatePayDistributionChart(payDistribution);
    }

    function processHoursByGuard(entries) {
      const guardMap = {};
      
      entries.forEach(entry => {
        // Guard name comes directly from populated guardId object
        const guardName = entry.guardId?.guardName || 'Unknown Guard';
        
        if (!guardMap[guardName]) {
          guardMap[guardName] = { hours: 0, minutes: 0 };
        }
        
        guardMap[guardName].hours += entry.totalHours;
        guardMap[guardName].minutes += entry.totalMinutes;
      });

      // Normalize minutes
      Object.keys(guardMap).forEach(key => {
        const hours = guardMap[key].hours + Math.floor(guardMap[key].minutes / 60);
        const minutes = guardMap[key].minutes % 60;
        guardMap[key].total = parseFloat((hours + minutes / 60).toFixed(2));
      });

      return guardMap;
    }

    function processStatusBreakdown(entries) {
      const statusMap = { paid: 0, partial: 0, pending: 0 };
      
      entries.forEach(entry => {
        if (entry.status) {
          statusMap[entry.status] = (statusMap[entry.status] || 0) + 1;
        } else {
          statusMap.pending++;
        }
      });

      return statusMap;
    }

    function processTrendData(entries) {
      const trendMap = {};
      
      entries.forEach(entry => {
        const date = new Date(entry.createdAt).toLocaleDateString();
        if (!trendMap[date]) {
          trendMap[date] = 0;
        }
        trendMap[date] += entry.totalHours + (entry.totalMinutes / 60);
      });

      // Sort by date
      const sortedDates = Object.keys(trendMap).sort((a, b) => new Date(a) - new Date(b));
      return {
        dates: sortedDates.slice(-14), // Last 14 days
        values: sortedDates.slice(-14).map(d => parseFloat(trendMap[d].toFixed(2)))
      };
    }

    function processPayDistribution(entries) {
      const guardMap = {};
      
      entries.forEach(entry => {
        // Guard name comes directly from populated guardId object
        const guardName = entry.guardId?.guardName || 'Unknown Guard';
        
        if (!guardMap[guardName]) {
          guardMap[guardName] = 0;
        }
        
        guardMap[guardName] += entry.paidHours + (entry.paidMinutes / 60);
      });

      return guardMap;
    }

    function generateHoursBarChart(data) {
      const ctx = document.getElementById('hoursBarChart').getContext('2d');
      
      if (chartsInstances.hoursBar) {
        chartsInstances.hoursBar.destroy();
      }

      chartsInstances.hoursBar = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(data),
          datasets: [{
            label: 'Total Hours',
            data: Object.values(data).map(d => d.total),
            backgroundColor: 'rgba(102, 126, 234, 0.8)',
            borderColor: 'rgba(102, 126, 234, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    function generateStatusPieChart(data) {
      const ctx = document.getElementById('statusPieChart').getContext('2d');
      
      if (chartsInstances.statusPie) {
        chartsInstances.statusPie.destroy();
      }

      const colors = ['#4caf50', '#ff9800', '#f44336'];
      const labels = ['Paid', 'Partial', 'Pending'];
      
      chartsInstances.statusPie = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: [data.paid || 0, data.partial || 0, data.pending || 0],
            backgroundColor: colors,
            borderColor: '#fff',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    function generateHoursTrendChart(data) {
      const ctx = document.getElementById('hoursTrendChart').getContext('2d');
      
      if (chartsInstances.hoursTrend) {
        chartsInstances.hoursTrend.destroy();
      }

      chartsInstances.hoursTrend = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.dates,
          datasets: [{
            label: 'Hours Entered',
            data: data.values,
            borderColor: 'rgba(102, 126, 234, 1)',
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 4,
            pointBackgroundColor: 'rgba(102, 126, 234, 1)'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: true }
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    function generatePayDistributionChart(data) {
      const ctx = document.getElementById('payDistributionChart').getContext('2d');
      
      if (chartsInstances.payDistribution) {
        chartsInstances.payDistribution.destroy();
      }

      const colors = [
        '#667eea', '#764ba2', '#f093fb', '#f5576c', 
        '#4facfe', '#00f2fe', '#43e97b', '#fa7921'
      ];

      chartsInstances.payDistribution = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(data),
          datasets: [{
            label: 'Hours Paid',
            data: Object.values(data),
            backgroundColor: colors.slice(0, Object.keys(data).length),
            borderColor: colors.slice(0, Object.keys(data).length),
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: 'y',
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: { beginAtZero: true }
          }
        }
      });
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => toast.remove(), 3000);
    }
  </script>
</body>
</html>
