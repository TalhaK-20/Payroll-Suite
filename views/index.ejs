<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payroll Management System</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" type="image/png" href="/images/salary.png">
</head>
<body>
  <header>
    <div class="container">
      <div class="header-brand">
        <img src="/images/salary.png" alt="Payroll Logo" class="logo">
        <h1>Payroll Management System</h1>
      </div>
      <nav>
        <ul>
          <li><a href="/">Dashboard</a></li>
          <li><a href="/upload">Upload Excel</a></li>
          <li><a href="#" onclick="openAddForm(); return false;">Add Record</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <!-- Alerts -->
      <div id="alertContainer"></div>

      <!-- Page Header -->
      <div class="page-header">
        <h2>Payroll Dashboard</h2>
        <p>Manage and track all payroll records efficiently</p>
      </div>

      <!-- Export Section -->
      <div class="export-section">
        <div class="export-title">ğŸ“Š Export Data</div>
        <div class="export-buttons">
          <button id="exportPDF" class="btn btn-secondary">
            ğŸ“„ Export to PDF
          </button>
          <button id="exportExcel" class="btn btn-success">
            ğŸ“‘ Export to Excel
          </button>
          <button onclick="openAddForm()" class="btn btn-primary">
            â• Add New Record
          </button>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="filter-section">
        <div class="filter-title">ğŸ” Advanced Filters</div>
        <div class="filter-grid">
          <div class="filter-input">
            <label>Guard Name</label>
            <input type="text" id="filterGuard" placeholder="Search by guard name">
          </div>
          <div class="filter-input">
            <label>Insurance Number</label>
            <input type="text" id="filterInsurance" placeholder="Search by insurance no">
          </div>
          <div class="filter-input">
            <label>Visa Status</label>
            <select id="filterVisa">
              <option value="">-- All Visa Status --</option>
              <option value="Student">Student</option>
              <option value="Skilled Worker">Skilled Worker</option>
              <option value="PSW">PSW</option>
              <option value="Dependent/Spouse">Dependent/Spouse</option>
              <option value="Permanent Resident">Permanent Resident</option>
              <option value="Settled Status">Settled Status</option>
              <option value="Pre-Settled Status">Pre-Settled Status</option>
              <option value="Refugee/Asylum">Refugee/Asylum</option>
            </select>
          </div>
          <div class="filter-input">
            <label>Nationality</label>
            <input type="text" id="filterNationality" placeholder="Search by nationality">
          </div>
        </div>
        <div class="filter-actions">
          <button id="applyFilters" class="btn btn-primary">Apply Filters</button>
          <button id="resetFilters" class="btn btn-secondary">Reset</button>
        </div>
      </div>

      <!-- Payroll Table -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Guard Name</th>
              <th>Nationality</th>
              <th>Insurance #</th>
              <th>Visa Status</th>
              <th>Hours:Min</th>
              <th>Pay Rate</th>
              <th>Bank Accounts</th>
              <th>ğŸ“„ Generate</th>
              <th>âš™ï¸ Manage</th>
            </tr>
          </thead>
          <tbody id="payrollTableBody">
            <tr>
              <td colspan="9" class="text-center">
                <div class="spinner">
                  <div class="loading"></div>
                  <span>Loading records...</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Form Modal -->
  <div id="formModal" class="modal">
    <div class="modal-content modal-professional" style="max-height: 90vh; overflow-y: auto;">
      <div class="modal-header-professional" style="position: sticky; top: 0; background: white; z-index: 100;">
        <div class="modal-title-section">
          <div class="modal-icon">ğŸ“‹</div>
          <div>
            <h2 id="formModalTitle">Add New Payroll Record</h2>
            <p class="modal-subtitle">Enter complete guard and payment information</p>
          </div>
        </div>
        <button class="modal-close-btn" onclick="closeFormModal()">âœ•</button>
      </div>
      
      <form id="payrollForm">
        <input type="hidden" id="id" name="id">
        
        <!-- SECTION 1: Guard Basic Information -->
        <div class="form-section">
          <h3 class="section-title">ğŸ‘¤ Guard Basic Information</h3>
          <div class="form-row-2col">
            <div class="form-group">
              <label>Guard Name <span class="required">*</span></label>
              <input type="text" id="guardName" name="guardName" placeholder="e.g., John Smith" required>
              <small class="field-hint">Employee's full name</small>
            </div>
            <div class="form-group">
              <label>Nationality <span class="required">*</span></label>
              <input type="text" id="nationality" name="nationality" placeholder="e.g., British, Indian, Pakistani" required>
              <small class="field-hint">Country of origin</small>
            </div>
          </div>
          <div class="form-row-2col">
            <div class="form-group">
              <label>Insurance Number <span class="required">*</span></label>
              <input type="text" id="insuranceNumber" name="insuranceNumber" placeholder="e.g., AB 123 456 C" required>
              <small class="field-hint">National Insurance: AB 123 456 C</small>
            </div>
            <div class="form-group">
              <label>Site Name</label>
              <input type="text" id="siteName" name="siteName" placeholder="e.g., Arnold Laver Peterborough">
              <small class="field-hint">Work location (optional)</small>
            </div>
          </div>
        </div>

        <!-- SECTION 2: Immigration & Visa Status -->
        <div class="form-section">
          <h3 class="section-title">ğŸ›‚ Immigration & Visa Status</h3>
          <div class="form-row-2col">
            <div class="form-group">
              <label>Visa Status <span class="required">*</span></label>
              <select id="visaStatus" name="visaStatus" required onchange="toggleShareCodeFields()">
                <option value="">-- Select Visa Status --</option>
                <option value="Student">Student</option>
                <option value="Skilled Worker">Skilled Worker</option>
                <option value="PSW">PSW (Points-Based System)</option>
                <option value="Dependent/Spouse">Dependent/Spouse</option>
                <option value="Permanent Resident">Permanent Resident</option>
                <option value="Settled Status">Settled Status</option>
                <option value="Pre-Settled Status">Pre-Settled Status</option>
                <option value="Refugee/Asylum">Refugee/Asylum Seeker</option>
              </select>
              <small class="field-hint">Immigration status classification</small>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="britishPassport" name="britishPassport" onchange="toggleShareCodeFields()">
                British Passport Holder
              </label>
              <small class="field-hint">Check if has British passport</small>
            </div>
          </div>
          
          <!-- Share Code Fields (shown only if NOT British Passport) -->
          <div id="shareCodeContainer" style="display: none;">
            <div class="form-row-2col">
              <div class="form-group">
                <label>Share Code <span class="required">*</span></label>
                <input type="text" id="shareCode" name="shareCode" placeholder="Enter share code">
                <small class="field-hint">Required for non-British passport holders</small>
              </div>
              <div class="form-group">
                <label>Share Code Expiry Date <span class="required">*</span></label>
                <input type="date" id="shareCodeExpiryDate" name="shareCodeExpiryDate">
                <small class="field-hint">When share code expires</small>
              </div>
            </div>
          </div>
        </div>

        <!-- SECTION 3: Client Information -->
        <div class="form-section">
          <h3 class="section-title">ğŸ¢ Client Information</h3>
          <div class="form-row-2col">
            <div class="form-group">
              <label>Client Name <span class="required">*</span></label>
              <input type="text" id="clientName" name="clientName" placeholder="e.g., SES Security" required>
              <small class="field-hint">Company/client name</small>
            </div>
          </div>
        </div>

        <!-- SECTION 4: Working Hours -->
        <div class="form-section">
          <h3 class="section-title">â° Working Hours</h3>
          <div class="form-row-2col">
            <div class="form-group">
              <label>Total Hours <span class="required">*</span></label>
              <input type="number" id="totalHours" name="totalHours" min="0" placeholder="e.g., 40" required onchange="calculateTotalPay()">
              <small class="field-hint">Number of hours worked</small>
            </div>
            <div class="form-group">
              <label>Total Minutes <span class="required">*</span></label>
              <input type="number" id="totalMinutes" name="totalMinutes" min="0" max="59" placeholder="e.g., 30" required onchange="calculateTotalPay()">
              <small class="field-hint">Minutes (0-59)</small>
            </div>
          </div>
        </div>

        <!-- SECTION 5: Rates -->
        <div class="form-section">
          <h3 class="section-title">ğŸ’· Rates</h3>
          <div class="form-row-2col">
            <div class="form-group">
              <label>Charge Rate <span class="currency">Â£/hour</span> <span class="required">*</span></label>
              <input type="number" id="chargeRate" name="chargeRate" step="0.01" min="0" placeholder="e.g., 18.75" required>
              <small class="field-hint">What client pays per hour</small>
            </div>
            <div class="form-group">
              <label>Pay Rate <span class="currency">Â£/hour</span> <span class="required">*</span></label>
              <input type="number" id="payRate" name="payRate" step="0.01" min="0" placeholder="e.g., 12.50" required onchange="calculateTotalPay()">
              <small class="field-hint">What guard is paid per hour</small>
            </div>
          </div>
          <div class="form-group">
            <p style="background: #f0f4ff; padding: 10px; border-radius: 5px; margin: 10px 0;">
              <strong>Calculated Total Pay:</strong> <span id="totalPayDisplay">Â£0.00</span>
            </p>
          </div>
        </div>

        <!-- SECTION 6: Bank Accounts (Multiple) -->
        <div class="form-section">
          <h3 class="section-title">ğŸ¦ Bank Account(s)</h3>
          <p style="color: #666; margin-bottom: 15px;">Add one or more bank accounts for payment distribution</p>
          
          <div id="bankAccountsContainer">
            <!-- Bank accounts will be added here dynamically -->
          </div>
          
          <button type="button" class="btn btn-info" onclick="addBankAccount()">
            â• Add Another Bank Account
          </button>
        </div>

        <!-- SECTION 7: Legacy Payment Amounts (for backward compatibility) -->
        <div class="form-section">
          <h3 class="section-title">ğŸ’· Legacy Payment Amounts</h3>
          <p style="color: #999; margin-bottom: 15px;">These fields are for backward compatibility. Use bank account distribution above.</p>
          <div class="form-row-3col">
            <div class="form-group">
              <label>Pay 1 <span class="currency">Â£</span></label>
              <input type="number" id="pay1" name="pay1" step="0.01" min="0" placeholder="e.g., 500">
              <small class="field-hint">Payroll 01</small>
            </div>
            <div class="form-group">
              <label>Pay 2 <span class="currency">Â£</span></label>
              <input type="number" id="pay2" name="pay2" step="0.01" min="0" placeholder="e.g., 550">
              <small class="field-hint">Payroll 02</small>
            </div>
            <div class="form-group">
              <label>Pay 3 <span class="currency">Â£</span></label>
              <input type="number" id="pay3" name="pay3" step="0.01" min="0" placeholder="e.g., 600">
              <small class="field-hint">Payroll 03</small>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions-professional">
          <button type="button" class="btn btn-secondary btn-large" onclick="closeFormModal()">Cancel</button>
          <button type="submit" class="btn btn-primary btn-large">ğŸ’¾ Save Record</button>
        </div>
      </form>
    </div>
  </div>

  <script src="/js/main.js"></script>
  <script src="/js/form-handler.js"></script>
</body>
</html>
